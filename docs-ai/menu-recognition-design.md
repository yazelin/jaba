# 菜單圖片辨識功能設計

## 概述
讓管理員上傳菜單圖片，由 AI 自動辨識並建立結構化菜單，減少手動輸入的工作量。

## 使用情境
1. 新增店家時，上傳實體菜單照片快速建立菜單
2. 店家更新菜單時，上傳新菜單照片進行更新

## 流程設計

### 步驟 1：圖片上傳
- 管理頁店家管理面板新增「上傳菜單圖片」按鈕
- 支援拖放或點擊選擇圖片
- 支援格式：JPG、PNG
- 圖片大小限制：10MB

### 步驟 2：選擇目標店家
- 下拉選單選擇現有店家
- 或選擇「新增店家」並輸入店家名稱

### 步驟 3：AI 辨識
- 呼叫 `/api/recognize-menu` API
- 使用 Claude Vision 分析圖片
- 提取：分類名稱、品項名稱、價格、描述（如有）

### 步驟 4：結果確認
- 以可編輯表格顯示辨識結果
- 每個品項可以：編輯、刪除
- 可以新增遺漏的品項
- 顯示信心度或標記不確定的項目

### 步驟 5：儲存
- 確認後呼叫 `update_menu` action 儲存
- 更新店家管理面板顯示

## API 設計

### POST /api/recognize-menu

**Request:**
```json
{
  "store_id": "existing-store-id",  // 可選，如果是新店家則不傳
  "store_name": "新店家名稱",        // 新店家時必填
  "image": "base64編碼的圖片"
}
```

**Response:**
```json
{
  "success": true,
  "store_id": "store-id",
  "recognized_menu": {
    "categories": [
      {
        "name": "主餐",
        "items": [
          {
            "id": "temp-1",
            "name": "雞腿便當",
            "price": 85,
            "description": "",
            "confidence": 0.95
          }
        ]
      }
    ]
  },
  "warnings": ["部分項目價格無法辨識，請手動確認"]
}
```

## UI 設計

### 上傳區域
```
┌──────────────────────────────────┐
│  📷 上傳菜單圖片                   │
│  ┌────────────────────────────┐ │
│  │                            │ │
│  │   拖放圖片到這裡            │ │
│  │   或點擊選擇檔案            │ │
│  │                            │ │
│  └────────────────────────────┘ │
│  選擇店家：[下拉選單 ▼]          │
│           [上傳並辨識]           │
└──────────────────────────────────┘
```

### 辨識結果編輯
```
┌──────────────────────────────────────────┐
│  📋 辨識結果 - 請確認以下菜單             │
│  ⚠️ 部分項目可能需要手動修正             │
├──────────────────────────────────────────┤
│  【主餐】                     [+新增品項] │
│  ┌────────┬────────┬────────┬────────┐  │
│  │ 品名    │ 價格   │ 說明   │ 操作   │  │
│  ├────────┼────────┼────────┼────────┤  │
│  │雞腿便當 │ $85    │        │ ✏️ 🗑️ │  │
│  │排骨便當 │ $80    │        │ ✏️ 🗑️ │  │
│  └────────┴────────┴────────┴────────┘  │
│                                          │
│  【湯品】                     [+新增品項] │
│  ┌────────┬────────┬────────┬────────┐  │
│  │ 品名    │ 價格   │ 說明   │ 操作   │  │
│  ├────────┼────────┼────────┼────────┤  │
│  │味噌湯   │ $20    │        │ ✏️ 🗑️ │  │
│  └────────┴────────┴────────┴────────┘  │
│                                          │
│  [+新增分類]                             │
│                                          │
│      [取消]              [確認並儲存]     │
└──────────────────────────────────────────┘
```

## 實作檔案

1. `main.py` - 新增 `/api/recognize-menu` API
2. `app/claude.py` - 新增 `_recognize_menu_image()` 函數
3. `templates/manager.html` - 新增上傳 UI 和結果編輯介面
4. `static/css/style.css` - 新增相關樣式

## Claude Vision 提示詞設計

```
請分析這張菜單圖片，提取所有菜單項目。

回傳 JSON 格式：
{
  "categories": [
    {
      "name": "分類名稱",
      "items": [
        {
          "name": "品項名稱",
          "price": 數字價格,
          "description": "描述（如有）"
        }
      ]
    }
  ]
}

注意事項：
- 價格請只填數字，不含貨幣符號
- 如果無法辨識價格，請填 0
- 盡可能保留原始分類結構
- 如果沒有分類，請使用「一般」作為分類名稱
```

## 錯誤處理

1. 圖片太大或格式不支援 → 前端驗證並提示
2. AI 無法辨識 → 顯示錯誤訊息，建議手動輸入
3. 部分項目辨識不確定 → 標記並提醒用戶確認
