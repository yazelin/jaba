# Proposal: handle-payment-on-order-change

## Why
目前付款狀態的處理有漏洞：當使用者已付款後修改訂單（新增品項、變更數量），付款狀態不會自動更新，導致管理員看到錯誤的付款資訊。

**問題場景：**
1. 亞澤訂了 $100 的便當，管理員標記已付款
2. 亞澤修改訂單，變成 $150
3. 管理員頁面仍顯示「亞澤已付 $150」（實際只付了 $100）

## What Changes

### 付款狀態智慧處理
當訂單金額變動且該使用者已付款時：

| 情況 | 付款狀態 | 備註 |
|------|----------|------|
| 金額增加 | 未付（部分已付）| 「已付 $100，待補 $50」|
| 金額減少 | 已付 | 「待退 $30」|
| 金額不變 | 維持原狀 | - |

### 資料結構擴充
`payments.json` 的 record 新增欄位：
- `paid_amount`: 實際已收金額（用於計算差額）

### 前端顯示
- 付款狀態面板顯示備註資訊
- 「部分已付」用不同顏色標示

## Scope
- `app/data.py` - `update_daily_summary_with_order()` 函數
- `templates/manager.html` - 付款狀態面板顯示
- `static/css/style.css` - 部分已付樣式

## Out of Scope
- 自動退款功能
- 付款歷史記錄
